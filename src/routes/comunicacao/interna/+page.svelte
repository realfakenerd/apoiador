<script lang="ts">
	import { Button } from '$lib/components/ui/button';
	import { Card, CardContent, CardFooter, CardHeader, CardTitle } from '$lib/components/ui/card';
	import { Input } from '$lib/components/ui/input';
	import { Label } from '$lib/components/ui/label';
	import { Separator } from '$lib/components/ui/separator';
	import { formatDate } from '$lib/utils';
	import Icon from '@iconify/svelte';

	let seuNome = $state('');
	let ref = $state('');
	let paraQuem = $state('');
	let documento = $state('');
	let documentos = $state<string[]>([]);

	const hoje = formatDate(new Date(), 'pt-BR', { dateStyle: 'short' });

	function addDocumento() {
		if (!documento) return;
		documentos.push(documento);
		documento = '';
	}

	function removeDocumento(index: number) {
		documentos.splice(documentos.indexOf(String(index)));
	}
</script>

<section class="p-10 pb-16 flex flex-col gap-6 print:hidden">
	<header class="flex flex-col gap-0.5">
		<h2 class="text-2xl">Comunicação Interna</h2>
		<p class="text-muted-foreground">
			Documento que serve para protocolar a movimentação dos documentos nos setores da empresa
		</p>
	</header>

	<Separator />

	<form
		class="flex flex-col gap-6"
		onsubmit={(e) => {
			e.preventDefault();
			print();
		}}
	>
		<Card class="w-full">
			<CardHeader>
				<CardTitle class="text-lg" tag="h2">Dados do protocolo</CardTitle>
			</CardHeader>

			<CardContent class="grid grid-cols-1 md:grid-cols-3 place-items-center gap-4 w-full">
				<div class="grid w-full items-center gap-1.5">
					<Label for="seuNome">Seu nome</Label>
					<Input
						required
						type="text"
						id="seuNome"
						placeholder="José Silva Sauro"
						bind:value={seuNome}
					/>
				</div>
				<div class="grid w-full items-center gap-1.5">
					<Label for="praQuem">Para quem</Label>
					<Input
						required
						type="text"
						id="praQuem"
						placeholder="Joana Silva Sauro"
						bind:value={paraQuem}
					/>
				</div>
				<div class="grid w-full items-center gap-1.5">
					<Label for="ref">Ref</Label>
					<Input
						required
						type="text"
						id="ref"
						placeholder="Condomínio Solar do Centro"
						bind:value={ref}
					/>
				</div>

				<div class="w-full md:col-span-3 flex flex-col gap-3">
					<p class="text-md font-medium leading-none">Documentos enviados</p>
					<div class="flex w-full flex-col sm:flex-row gap-4">
						<Input placeholder="1 Contrato Assinado" type="text" bind:value={documento} />
						<Button on:click={addDocumento}>Adicionar Documento</Button>
					</div>

					<div>
						<p>Segue:</p>
						<ul class="my-6 ml-6 [&>li]:mt-2 flex flex-col w-full">
							{#each documentos as documento, i (i)}
								<li class="border-l-2 border-primary pl-6 inline-flex items-center gap-x-4 w-full">
									{documento}
									<Button variant="destructive" on:click={() => removeDocumento(i)}
										><Icon icon="mdi:delete" /></Button
									>
								</li>
							{:else}
								<li>Lista está vazia</li>
							{/each}
						</ul>
					</div>
				</div>
				<CardFooter class="md:col-span-3 w-full">
					<Button type="submit" class="w-full">Imprimir</Button>
				</CardFooter>
			</CardContent>
		</Card>
	</form>
</section>

{#snippet impressao({ass = true}: {ass: boolean})}
	<div class="flex gap-6 border-2 flex-col">
		<header class="inline-flex gap-6 border-b items-center p-3">
			<div class="inline-flex gap-3 items-center flex-1">
				<svg
					class="h-8 w-8"
					width="51"
					height="28"
					viewBox="0 0 51 28"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
					<path
						d="M38.3692 0.168948C37.8466 0.213423 37.2398 0.284583 37.0207 0.337954C36.7931 0.391324 36.2368 0.515855 35.7733 0.604805C34.6439 0.836076 33.4555 1.12961 33.2448 1.23635C33.1521 1.28083 32.9076 1.36088 32.6969 1.41425C32.0901 1.57436 28.7103 2.80188 28.2721 3.01536C28.1794 3.05983 27.9012 3.18437 27.6652 3.28221C26.4853 3.76254 26.3167 3.8337 26.0807 3.94934C25.9459 4.0205 25.5076 4.22508 25.1115 4.40299C23.6787 5.05232 20.4759 6.7068 19.0852 7.50735C18.7649 7.69415 18.2677 7.96989 17.9895 8.13C17.054 8.65481 16.7337 8.8505 15.5706 9.58879C14.9301 9.98907 14.4075 10.336 14.4075 10.3538C14.4075 10.4071 14.8374 10.2292 14.9554 10.1403C14.9975 10.0958 15.4021 9.90012 15.8403 9.68664C16.6157 9.32194 17.7114 8.78824 18.411 8.44133C19.0599 8.11221 19.7089 7.81868 19.7679 7.81868C19.7932 7.81868 20.164 7.64967 20.5939 7.44509C21.0153 7.2494 21.6306 6.97365 21.9508 6.84022C22.2796 6.7068 22.8274 6.47553 23.173 6.32431C23.5185 6.1731 24.1675 5.90625 24.6058 5.72835C25.044 5.55044 25.4823 5.37254 25.575 5.32807C25.6677 5.2747 26.0133 5.15017 26.3336 5.03453C26.6623 4.9189 27.5472 4.60757 28.3142 4.33182C30.042 3.71807 30.986 3.40674 31.6603 3.24663C31.9468 3.17547 32.2165 3.09541 32.2587 3.06873C32.4357 2.95309 35.0231 2.4016 36.7425 2.10807C37.0881 2.0547 38.209 2.00133 39.2289 2.00133C40.9145 2.00133 41.1505 2.01912 41.8416 2.20591C42.9963 2.52613 43.9824 3.05094 44.5134 3.63801L44.7663 3.92265L44.7073 3.45122C44.5724 2.38381 43.8644 1.37867 42.8868 0.862761C41.7237 0.240108 40.3498 0.0355225 38.3692 0.168948Z"
						fill="#F4701E"
					/>
					<path
						d="M36.2792 4.62535C35.7229 4.66093 35.0571 4.74098 34.8042 4.78546C34.5514 4.83883 33.8855 4.96336 33.3293 5.0612C31.888 5.30137 29.2331 5.94181 28.8623 6.12861C28.7696 6.17309 28.4493 6.27983 28.1459 6.35988C27.8424 6.43104 27.5643 6.52889 27.5137 6.56447C27.4716 6.60005 27.185 6.70679 26.8816 6.79574C26.5782 6.88469 26.2916 6.99143 26.2411 7.0359C26.1905 7.08038 25.9376 7.16933 25.6932 7.24938C25.4404 7.32944 25.2044 7.41839 25.1538 7.46287C25.1117 7.49845 24.8588 7.59629 24.606 7.68524C24.3531 7.77419 24.1087 7.87204 24.0581 7.90762C24.016 7.9432 23.7884 8.04104 23.5524 8.12999C23.3249 8.21894 23.0973 8.31679 23.0467 8.35237C23.0046 8.38795 22.777 8.4858 22.541 8.57475C22.3135 8.6637 22.0859 8.76154 22.0353 8.79712C21.9932 8.8327 21.5886 9.02839 21.1504 9.22408C19.608 9.909 15.2506 12.1683 12.8485 13.5115C12.1574 13.9029 11.3061 14.3654 10.9774 14.5522C10.6403 14.7301 10.379 14.8902 10.3959 14.908C10.4127 14.9258 10.9016 14.7212 11.4831 14.4455C12.0647 14.1786 12.5704 13.9562 12.6041 13.9562C12.6462 13.9562 12.7979 13.894 12.9328 13.8139C13.1688 13.6805 13.8515 13.3959 14.6184 13.1023C14.8039 13.0312 15.0736 12.9155 15.2084 12.8444C15.3517 12.7732 15.8237 12.5686 16.262 12.3996C16.7002 12.2217 17.1385 12.0438 17.2312 11.9993C17.3239 11.946 17.6273 11.8303 17.9055 11.7236C18.1836 11.6168 18.7146 11.4212 19.0854 11.2788C20.2233 10.843 23.6704 9.62436 24.606 9.33082C25.0948 9.17961 25.6427 8.99281 25.8281 8.93055C26.0135 8.85939 26.4096 8.74375 26.713 8.6637C27.0165 8.59254 27.4547 8.46801 27.6823 8.39685C29.0393 7.96099 31.9386 7.32944 34.2564 6.95585C35.5712 6.74237 40.468 6.73347 41.3361 6.94695C43.3842 7.43618 44.6063 8.04994 45.6851 9.12624C46.0054 9.44646 46.2667 9.67773 46.2667 9.63326C46.2583 9.33082 45.879 8.03215 45.6514 7.55182C45.0952 6.35988 43.7972 5.36364 42.3813 5.01673C42.0357 4.93667 41.6648 4.82993 41.5469 4.78546C40.9484 4.56308 38.3525 4.48303 36.2792 4.62535Z"
						fill="#F4701E"
					/>
					<path
						d="M35.0571 9.78448C34.0288 9.86454 33.7001 9.91791 31.6015 10.3449C29.4691 10.7807 27.2946 11.3589 25.0274 12.0705C23.6367 12.5153 20.2485 13.7784 19.5068 14.1342C19.4141 14.1786 18.9759 14.3654 18.5376 14.5433C18.0993 14.7212 17.543 14.9614 17.3071 15.077C17.0711 15.1927 16.8435 15.2905 16.8098 15.2905C16.7761 15.2905 16.5907 15.3706 16.3968 15.4684C16.2029 15.5574 15.7647 15.762 15.4191 15.9221C15.0736 16.0733 14.6016 16.2957 14.3656 16.4024C14.138 16.518 13.6576 16.7404 13.312 16.8916C12.9665 17.0517 12.2838 17.3809 11.7949 17.621C11.3061 17.8701 10.7414 18.1458 10.5307 18.2437C10.32 18.3415 9.73001 18.6439 9.20746 18.9019C8.69333 19.1688 8.24663 19.3822 8.22135 19.3822C8.19606 19.3822 7.63137 19.658 6.97396 19.9871C6.30812 20.3251 5.64229 20.6453 5.49058 20.7165C5.33887 20.7788 5.2293 20.841 5.24616 20.8588C5.27144 20.8944 6.01313 20.6098 6.44298 20.4052C6.58626 20.3429 6.86439 20.2362 7.0751 20.1828C7.28581 20.1205 7.49651 20.0405 7.53866 20.0049C7.58923 19.9693 7.81679 19.8715 8.04435 19.7914C8.28035 19.7202 8.84504 19.5157 9.3086 19.3378C9.77216 19.1688 11.1965 18.6617 12.4692 18.217C13.7419 17.7722 14.8629 17.372 14.9556 17.3275C15.1241 17.2474 15.7394 17.0428 16.8941 16.7048C17.2228 16.607 17.5599 16.4913 17.6526 16.4469C17.7453 16.4024 18.1077 16.2779 18.4533 16.1711C18.7989 16.0644 19.3888 15.8954 19.7597 15.7797C21.1166 15.3706 22.3893 15.0059 23.0046 14.8369C23.3501 14.7479 24.0328 14.57 24.5217 14.4455C25.8534 14.0897 27.1345 13.7961 28.3566 13.556C28.9634 13.4403 29.5112 13.3247 29.5787 13.298C29.6967 13.2536 31.3739 12.9956 32.9078 12.791C34.8969 12.5331 38.7487 12.5331 40.1562 12.791C42.0526 13.1468 43.0134 13.4492 44.3282 14.1075C45.5756 14.739 46.9915 15.8687 47.8849 16.9539L48.2052 17.3453V17.0428C48.2052 15.7531 47.5225 14.0897 46.5448 12.9689C44.3872 10.5139 40.3922 9.41089 35.0571 9.78448Z"
						fill="#F4701E"
					/>
					<path
						d="M34.0456 16.4558C32.4611 16.5536 29.6966 16.9628 28.9633 17.2118C28.8622 17.2474 28.3986 17.3631 27.9351 17.4787C26.3674 17.8523 25.5751 18.0569 25.4066 18.1369C25.3139 18.1814 24.9767 18.2792 24.648 18.3593C24.3277 18.4394 23.999 18.5283 23.9316 18.5728C23.8642 18.6084 23.5186 18.7151 23.1731 18.804C22.8275 18.893 22.5072 18.9908 22.4567 19.0264C22.4145 19.062 22.1111 19.1599 21.7824 19.2488C21.4621 19.3378 21.1587 19.4356 21.1081 19.4712C21.066 19.5068 20.7626 19.6046 20.4339 19.6936C20.1136 19.7825 19.8102 19.8803 19.7596 19.9159C19.7175 19.9515 19.4478 20.0494 19.1696 20.1294C18.8915 20.2095 18.5881 20.3162 18.4954 20.3607C18.4026 20.4052 17.8548 20.6097 17.2733 20.8054C16.6917 21.01 16.1102 21.2324 15.9669 21.2947C15.832 21.3569 15.5455 21.4637 15.3347 21.5259C15.124 21.5882 14.9218 21.6683 14.8712 21.6949C14.829 21.7305 14.5762 21.8284 14.3233 21.9173C14.0705 22.0063 13.8261 22.1041 13.7755 22.1397C13.7334 22.1753 13.4805 22.2731 13.2277 22.3621C12.9748 22.451 12.7304 22.5489 12.6798 22.5844C12.6377 22.62 12.3848 22.7179 12.132 22.7979C11.8791 22.8869 11.5589 23.0114 11.4156 23.0826C11.2807 23.1448 10.8003 23.3494 10.362 23.5184C9.92378 23.6963 9.49393 23.8742 9.40122 23.9276C9.31694 23.981 9.08937 24.0788 8.89552 24.1411C8.45725 24.2923 7.52171 24.6926 7.24358 24.8438C7.12558 24.906 6.88116 25.0128 6.69574 25.075C6.51031 25.1373 6.32489 25.2174 6.27432 25.2529C6.19847 25.3241 5.84448 25.4753 4.84151 25.8845C4.61395 25.9823 4.31053 26.1158 4.16725 26.1869C4.03239 26.2581 3.62784 26.436 3.28228 26.5872C2.93671 26.7384 2.54058 26.9163 2.3973 26.9875C2.26245 27.0497 1.84946 27.2365 1.48705 27.3967C1.12463 27.5479 0.846496 27.6902 0.863353 27.708C0.888637 27.7436 2.25402 27.2721 2.56587 27.1298C2.65858 27.0853 2.94514 26.9786 3.19799 26.8985C3.45084 26.8185 3.7374 26.7206 3.83011 26.6762C3.92283 26.6317 4.22624 26.5249 4.50438 26.4449C4.78251 26.3648 5.05222 26.267 5.09436 26.2314C5.14493 26.2047 5.44835 26.098 5.76862 26.009C6.09733 25.9201 6.40075 25.8222 6.44289 25.7778C6.49346 25.7422 6.77159 25.6443 7.07501 25.5732C7.37843 25.4931 7.69871 25.3864 7.79142 25.3419C7.88413 25.2974 8.24654 25.1729 8.5921 25.0662C8.93767 24.9683 9.52765 24.7815 9.89849 24.6748C12.9411 23.7408 14.6773 23.2605 17.9897 22.4421C21.8583 21.4903 26.8394 20.672 30.6743 20.3607C31.9806 20.2539 36.3381 20.2539 37.4169 20.3518C38.4873 20.4585 40.7629 20.7876 41.0832 20.8944C41.2265 20.9389 41.6563 21.0545 42.0525 21.1523C42.9374 21.3658 43.8645 21.6594 44.2017 21.8195C44.345 21.8817 44.6062 21.9885 44.7832 22.0507C45.3142 22.2286 46.9072 23.1181 47.7416 23.7052C48.5507 24.2656 50.1689 25.8489 50.5819 26.4805C50.7252 26.6939 50.8432 26.8541 50.86 26.8363C50.8769 26.8185 50.8095 26.3915 50.7168 25.8845C50.2448 23.216 49.2671 21.4903 47.3454 19.8803C46.4268 19.1154 45.2131 18.3593 44.2438 17.9679C44.0837 17.8968 43.8393 17.79 43.696 17.7278C43.0639 17.4253 40.9736 16.8649 39.7347 16.6692C38.9677 16.5447 36.2369 16.349 35.6048 16.3668C35.4194 16.3757 34.7198 16.4202 34.0456 16.4558Z"
						fill="#F4701E"
					/>
				</svg>
				<h1 class="ph1">Comunicação Interna</h1>
			</div>
			<h2>{seuNome}</h2>
			<div class="w-4 border rotate-90"></div>
			<span class="inline-flex gap-1">
				<p>Data:</p>
				<p>{hoje}</p>
			</span>
		</header>

		<div class="flex flex-col gap-3 p-3">
			<div class="inline-flex gap-3 items-center self-stretch">
				<p>Para:</p>
				<p>{paraQuem}</p>
			</div>
			<div class="inline-flex gap-3 items-center self-stretch">
				<p>Ref:</p>
				<p>{ref}</p>
			</div>
			<div class="flex flex-col justify-center gap-3 self-stretch">
				<span>Segue:</span>
				<ul class="[&>li]:pl-3">
					{#each documentos as documento}
						<li>{documento}</li>
					{:else}
						<li>sem documentos na lista</li>
					{/each}
				</ul>
			</div>
			{#if ass}
				<div class="inline-flex gap-3 items-center self-stretch">
					<p>
						Ass:
						__________________________________________________________________________________________
					</p>
				</div>
			{/if}
		</div>
	</div>
{/snippet}

<section class="hidden print:block print:text-black">
	{@render impressao({ ass: true })}
</section>
<hr class="hidden print:block border-dotted" />
<section class="hidden print:block print:text-black">
	{@render impressao({ ass: false })}
</section>
<hr class="hidden print:block border-dotted" />

<style>
	.ph1 {
		font-size: 14px;
		font-style: normal;
		font-weight: 400;
		line-height: 16px; /* 133.333% */
		letter-spacing: 0.4px;
		text-transform: uppercase;
	}
</style>
